#include <Servo.h>
#include <Adafruit_LSM6DSOX.h>
#include <math.h>
#include <stdio.h>

// For SPI mode, we need a CS pin
#define LSM_CS 10
// For software-SPI mode we need SCK/MOSI/MISO pins
#define LSM_SCK 13
#define LSM_MISO 12
#define LSM_MOSI 11

// Temporary test values for walking motion in txt file
#define ROWS = 174
#define COLS = 6

Adafruit_LSM6DSOX sox;

Servo left_hip_1;
Servo left_hip_2;
Servo left_hip_3;
Servo left_knee; // higher is back
Servo left_ankle_1;
Servo left_ankle_2;
Servo right_hip_1;
Servo right_hip_2;
Servo right_hip_3;
Servo right_knee; // Higher is forward
Servo right_ankle_1;
Servo right_ankle_2;

float stepdata[][12] = {
{-0.000000, -0.000898, -0.046142, 0.094714, -0.048572, 0.000898, -0.000000, -0.000898, -0.046142, 0.094714, -0.048572, 0.000898}, 
{-0.000000, -0.003775, -0.094422, 0.193830, -0.099408, 0.003775, -0.000000, -0.003775, -0.094422, 0.193830, -0.099408, 0.003775}, 
{-0.000000, -0.008411, -0.140461, 0.288368, -0.147907, 0.008411, -0.000000, -0.008411, -0.140461, 0.288368, -0.147907, 0.008411}, 
{-0.000000, -0.014591, -0.184161, 0.378134, -0.193974, 0.014591, -0.000000, -0.014591, -0.184161, 0.378134, -0.193974, 0.014591}, 
{-0.000000, -0.022102, -0.225421, 0.462929, -0.237508, 0.022102, -0.000000, -0.022102, -0.225421, 0.462929, -0.237508, 0.022102}, 
{-0.000000, -0.030727, -0.264141, 0.542545, -0.278404, 0.030727, -0.000000, -0.030727, -0.264141, 0.542545, -0.278404, 0.030727}, 
{-0.000000, -0.040238, -0.300215, 0.616766, -0.316551, 0.040238, -0.000000, -0.040238, -0.300215, 0.616766, -0.316551, 0.040238}, 
{-0.000000, -0.050387, -0.333534, 0.685362, -0.351829, 0.050387, -0.000000, -0.050387, -0.333534, 0.685362, -0.351829, 0.050387}, 
{-0.000000, -0.060901, -0.363982, 0.748094, -0.384111, 0.060901, -0.000000, -0.060901, -0.363982, 0.748094, -0.384111, 0.060901}, 
{-0.000000, -0.071482, -0.391439, 0.804701, -0.413262, 0.071482, -0.000000, -0.071482, -0.391439, 0.804701, -0.413262, 0.071482}, 
{-0.000000, -0.081802, -0.415770, 0.854900, -0.439130, 0.081802, -0.000000, -0.081802, -0.415770, 0.854900, -0.439130, 0.081802}, 
{-0.000000, -0.091506, -0.436829, 0.898377, -0.461548, 0.091506, -0.000000, -0.091506, -0.436829, 0.898377, -0.461548, 0.091506}, 
{-0.000000, -0.100214, -0.454444, 0.934768, -0.480324, 0.100214, -0.000000, -0.100214, -0.454444, 0.934768, -0.480324, 0.100214}, 
{-0.000000, -0.107525, -0.468413, 0.963641, -0.495228, 0.107525, -0.000000, -0.107525, -0.468413, 0.963641, -0.495228, 0.107525}, 
{-0.000000, -0.113031, -0.478485, 0.984468, -0.505983, 0.113031, -0.000000, -0.113031, -0.478485, 0.984468, -0.505983, 0.113031}, 
{-0.000000, -0.116325, -0.484339, 0.996577, -0.512238, 0.116325, -0.000000, -0.116325, -0.484339, 0.996577, -0.512238, 0.116325}, 
{-0.000000, -0.116745, -0.485381, 0.999577, -0.514197, 0.116745, -0.000000, -0.115362, -0.525710, 1.066073, -0.540362, 0.115362}, 
{-0.000000, -0.114904, -0.483576, 1.000350, -0.516775, 0.114904, -0.000000, -0.108747, -0.624832, 1.220075, -0.595243, 0.108747}, 
{-0.000000, -0.110580, -0.479130, 1.002041, -0.522911, 0.110580, -0.000000, -0.095785, -0.734780, 1.366388, -0.631608, 0.095785}, 
{-0.000000, -0.102762, -0.470725, 1.004649, -0.533924, 0.102762, -0.000000, -0.075732, -0.817982, 1.439534, -0.621552, 0.075732}, 
{-0.000000, -0.090424, -0.456749, 1.007585, -0.550837, 0.090424, -0.000000, -0.050950, -0.839724, 1.392860, -0.553136, 0.050950}, 
{-0.000000, -0.072531, -0.435128, 1.009290, -0.574162, 0.072531, -0.000000, -0.028025, -0.802574, 1.250520, -0.447946, 0.028025}, 
{-0.000000, -0.048033, -0.403138, 1.006746, -0.603608, 0.048033, -0.000000, -0.011719, -0.734328, 1.071983, -0.337654, 0.011719}, 
{-0.000000, -0.015889, -0.357197, 0.994826, -0.637629, 0.015889, -0.000000, -0.003856, -0.678940, 0.942722, -0.263782, 0.003856}, 
{0.000000, 0.003295, -0.332821, 0.991496, -0.658676, -0.003295, 0.000000, 0.035718, -0.643124, 0.966172, -0.323048, -0.035718}, 
{0.000000, 0.003277, -0.348968, 1.017813, -0.668845, -0.003277, 0.000000, 0.064041, -0.615317, 0.981836, -0.366518, -0.064041}, 
{0.000000, 0.003246, -0.374053, 1.057754, -0.683701, -0.003246, 0.000000, 0.086449, -0.590165, 0.988769, -0.398604, -0.086449}, 
{0.000000, 0.003199, -0.405990, 1.107025, -0.701035, -0.003199, 0.000000, 0.104141, -0.568276, 0.990861, -0.422585, -0.104141}, 
{0.000000, 0.003136, -0.442894, 1.161697, -0.718803, -0.003136, 0.000000, 0.118070, -0.549652, 0.990397, -0.440745, -0.118070}, 
{0.000000, 0.003055, -0.483132, 1.218351, -0.735219, -0.003055, 0.000000, 0.128987, -0.534016, 0.988722, -0.454706, -0.128987}, 
{0.000000, 0.002956, -0.525297, 1.274066, -0.748769, -0.002956, 0.000000, 0.137481, -0.520978, 0.986611, -0.465634, -0.137481}, 
{0.000000, 0.002836, -0.568135, 1.326328, -0.758193, -0.002836, 0.000000, 0.144010, -0.510121, 0.984504, -0.474382, -0.144010}, 
{0.000000, 0.002694, -0.610467, 1.372921, -0.762454, -0.002694, 0.000000, 0.148922, -0.501045, 0.982637, -0.481592, -0.148922}, 
{0.000000, 0.002531, -0.651106, 1.411827, -0.760721, -0.002531, 0.000000, 0.152481, -0.493377, 0.981133, -0.487755, -0.152481}, 
{0.000000, 0.002348, -0.688787, 1.441140, -0.752353, -0.002348, 0.000000, 0.154875, -0.486781, 0.980048, -0.493268, -0.154875}, 
{0.000000, 0.002145, -0.722114, 1.458991, -0.736877, -0.002145, 0.000000, 0.156233, -0.480947, 0.979408, -0.498461, -0.156233}, 
{0.000000, 0.001925, -0.749515, 1.463467, -0.713951, -0.001925, 0.000000, 0.156626, -0.475590, 0.979220, -0.503631, -0.156626}, 
{0.000000, 0.001695, -0.769631, 1.453330, -0.683699, -0.001695, 0.000000, 0.156075, -0.470434, 0.979487, -0.509053, -0.156075}, 
{0.000000, 0.001462, -0.782437, 1.430015, -0.647578, -0.001462, 0.000000, 0.154551, -0.465200, 0.980206, -0.515006, -0.154551}, 
{0.000000, 0.001232, -0.788291, 1.395449, -0.607158, -0.001232, 0.000000, 0.151973, -0.459590, 0.981368, -0.521778, -0.151973}, 
{0.000000, 0.001013, -0.787687, 1.351515, -0.563829, -0.001013, 0.000000, 0.148204, -0.453266, 0.982946, -0.529680, -0.148204}, 
{0.000000, 0.000809, -0.781285, 1.300130, -0.518845, -0.000809, 0.000000, 0.143042, -0.445825, 0.984876, -0.539051, -0.143042}, 
{0.000000, 0.000624, -0.769927, 1.243322, -0.473395, -0.000624, 0.000000, 0.136213, -0.436761, 0.987025, -0.550264, -0.136213}, 
{0.000000, 0.000461, -0.754658, 1.183337, -0.428679, -0.000461, 0.000000, 0.127350, -0.425416, 0.989132, -0.563715, -0.127350}, 
{0.000000, 0.000320, -0.736752, 1.122751, -0.386000, -0.000320, 0.000000, 0.115975, -0.410917, 0.990720, -0.579803, -0.115975}, 
{0.000000, 0.000204, -0.717746, 1.064608, -0.346862, -0.000204, 0.000000, 0.101477, -0.392069, 0.990947, -0.598878, -0.101477}, 
{0.000000, 0.000113, -0.699476, 1.012530, -0.313054, -0.000113, 0.000000, 0.083071, -0.367221, 0.988362, -0.621142, -0.083071}, 
{0.000000, 0.000048, -0.684068, 0.970750, -0.286682, -0.000048, 0.000000, 0.059767, -0.334049, 0.980495, -0.646446, -0.059767}, 
{0.000000, 0.000010, -0.673833, 0.943930, -0.270097, -0.000010, 0.000000, 0.030323, -0.289231, 0.963141, -0.673910, -0.030323}, 
{-0.000000, -0.035718, -0.642333, 0.966948, -0.324615, 0.035718, -0.000000, -0.003295, -0.239567, 0.942264, -0.702697, 0.003295}, 
{-0.000000, -0.064041, -0.614613, 0.982323, -0.367709, 0.064041, -0.000000, -0.003277, -0.257371, 0.971348, -0.713978, 0.003277}, 
{-0.000000, -0.086449, -0.589559, 0.989077, -0.399518, 0.086449, -0.000000, -0.003246, -0.285005, 1.015390, -0.730384, 0.003246}, 
{-0.000000, -0.104141, -0.567763, 0.991055, -0.423292, 0.104141, -0.000000, -0.003199, -0.320156, 1.069558, -0.749402, 0.003199}, 
{-0.000000, -0.118070, -0.549224, 0.990521, -0.441297, 0.118070, -0.000000, -0.003136, -0.360770, 1.129500, -0.768730, 0.003136}, 
{-0.000000, -0.128987, -0.533659, 0.988800, -0.455141, 0.128987, -0.000000, -0.003055, -0.405118, 1.191503, -0.786385, 0.003055}, 
{-0.000000, -0.137481, -0.520680, 0.986661, -0.465981, 0.137481, -0.000000, -0.002956, -0.451747, 1.252452, -0.800706, 0.002956}, 
{-0.000000, -0.144010, -0.509871, 0.984535, -0.474664, 0.144010, -0.000000, -0.002836, -0.499390, 1.309705, -0.810315, 0.002836}, 
{-0.000000, -0.148922, -0.500831, 0.982656, -0.481825, 0.148922, -0.000000, -0.002694, -0.546865, 1.360950, -0.814084, 0.002694}, 
{-0.000000, -0.152481, -0.493191, 0.981144, -0.487954, 0.152481, -0.000000, -0.002531, -0.592976, 1.404092, -0.811117, 0.002531}, 
{-0.000000, -0.154875, -0.486612, 0.980055, -0.493443, 0.154875, -0.000000, -0.002348, -0.636427, 1.437160, -0.800733, 0.002348}, 
{-0.000000, -0.156233, -0.480788, 0.979411, -0.498623, 0.156233, -0.000000, -0.002145, -0.675762, 1.458223, -0.782460, 0.002145}, 
{-0.000000, -0.156626, -0.475433, 0.979220, -0.503787, 0.156626, -0.000000, -0.001925, -0.709312, 1.465322, -0.756009, 0.001925}, 
{-0.000000, -0.156075, -0.470271, 0.979484, -0.509213, 0.156075, -0.000000, -0.001695, -0.735573, 1.457192, -0.721619, 0.001695}, 
{-0.000000, -0.154551, -0.465022, 0.980199, -0.515177, 0.154551, -0.000000, -0.001462, -0.754317, 1.435264, -0.680947, 0.001462}, 
{-0.000000, -0.151973, -0.459387, 0.981355, -0.521968, 0.151973, -0.000000, -0.001232, -0.765723, 1.401489, -0.635766, 0.001232}, 
{-0.000000, -0.148204, -0.453027, 0.982925, -0.529898, 0.148204, -0.000000, -0.001013, -0.770149, 1.357798, -0.587649, 0.001013}, 
{-0.000000, -0.143042, -0.445535, 0.984843, -0.539308, 0.143042, -0.000000, -0.000809, -0.768167, 1.306170, -0.538004, 0.000809}, 
{-0.000000, -0.136213, -0.436402, 0.986971, -0.550570, 0.136213, -0.000000, -0.000624, -0.760575, 1.248716, -0.488141, 0.000624}, 
{-0.000000, -0.127350, -0.424966, 0.989047, -0.564081, 0.127350, -0.000000, -0.000461, -0.748410, 1.187767, -0.439357, 0.000461}, 
{-0.000000, -0.115975, -0.410346, 0.990586, -0.580241, 0.115975, -0.000000, -0.000320, -0.732966, 1.126002, -0.393035, 0.000320}, 
{-0.000000, -0.101477, -0.391338, 0.990737, -0.599399, 0.101477, -0.000000, -0.000204, -0.715824, 1.066575, -0.350750, 0.000204}, 
{-0.000000, -0.083071, -0.366277, 0.988031, -0.621754, 0.083071, -0.000000, -0.000113, -0.698878, 1.013244, -0.314366, 0.000113}, 
{-0.000000, -0.059767, -0.332820, 0.979968, -0.647148, 0.059767, -0.000000, -0.000048, -0.684326, 0.970401, -0.286075, 0.000048}, 
{-0.000000, -0.030323, -0.287617, 0.962301, -0.674684, 0.030323, -0.000000, -0.000010, -0.674549, 0.942877, -0.268329, 0.000010}, 
{0.000000, 0.003295, -0.237479, 0.940979, -0.703500, -0.003295, 0.000000, 0.035718, -0.643124, 0.966172, -0.323048, -0.035718}, 
{0.000000, 0.003277, -0.255299, 0.970121, -0.714822, -0.003277, 0.000000, 0.064041, -0.615317, 0.981836, -0.366518, -0.064041}, 
{0.000000, 0.003246, -0.282955, 1.014245, -0.731290, -0.003246, 0.000000, 0.086449, -0.590165, 0.988769, -0.398604, -0.086449}, 
{0.000000, 0.003199, -0.318129, 1.068513, -0.750384, -0.003199, 0.000000, 0.104141, -0.568276, 0.990861, -0.422585, -0.104141}, 
{0.000000, 0.003136, -0.358765, 1.128563, -0.769798, -0.003136, 0.000000, 0.118070, -0.549652, 0.990397, -0.440745, -0.118070}, 
{0.000000, 0.003055, -0.403132, 1.190678, -0.787545, -0.003055, 0.000000, 0.128987, -0.534016, 0.988722, -0.454706, -0.128987}, 
{0.000000, 0.002956, -0.449779, 1.251741, -0.801962, -0.002956, 0.000000, 0.137481, -0.520978, 0.986611, -0.465634, -0.137481}, 
{0.000000, 0.002836, -0.497439, 1.309108, -0.811669, -0.002836, 0.000000, 0.144010, -0.510121, 0.984504, -0.474382, -0.144010}, 
{0.000000, 0.002694, -0.544933, 1.360469, -0.815536, -0.002694, 0.000000, 0.148922, -0.501045, 0.982637, -0.481592, -0.148922}, 
{0.000000, 0.002531, -0.591066, 1.403729, -0.812663, -0.002531, 0.000000, 0.152481, -0.493377, 0.981133, -0.487755, -0.152481}, 
{0.000000, 0.002348, -0.634548, 1.436915, -0.802367, -0.002348, 0.000000, 0.154875, -0.486781, 0.980048, -0.493268, -0.154875}, 
{0.000000, 0.002145, -0.673924, 1.458098, -0.784174, -0.002145, 0.000000, 0.156233, -0.480947, 0.979408, -0.498461, -0.156233}, 
{0.000000, 0.001925, -0.707526, 1.465317, -0.757790, -0.001925, 0.000000, 0.156626, -0.475590, 0.979220, -0.503631, -0.156626}, 
{0.000000, 0.001695, -0.733853, 1.457308, -0.723454, -0.001695, 0.000000, 0.156075, -0.470434, 0.979487, -0.509053, -0.156075}, 
{0.000000, 0.001462, -0.752676, 1.435498, -0.682823, -0.001462, 0.000000, 0.154551, -0.465200, 0.980206, -0.515006, -0.154551}, 
{0.000000, 0.001232, -0.764168, 1.401841, -0.637672, -0.001232, 0.000000, 0.151973, -0.459590, 0.981368, -0.521778, -0.151973}, 
{0.000000, 0.001013, -0.768686, 1.358265, -0.589578, -0.001013, 0.000000, 0.148204, -0.453266, 0.982946, -0.529680, -0.148204}, 
{0.000000, 0.000809, -0.766799, 1.306751, -0.539952, -0.000809, 0.000000, 0.143042, -0.445825, 0.984876, -0.539051, -0.143042}, 
{0.000000, 0.000624, -0.759302, 1.249408, -0.490106, -0.000624, 0.000000, 0.136213, -0.436761, 0.987025, -0.550264, -0.136213}, 
{0.000000, 0.000461, -0.747230, 1.188569, -0.441339, -0.000461, 0.000000, 0.127350, -0.425416, 0.989132, -0.563715, -0.127350}, 
{0.000000, 0.000320, -0.731875, 1.126911, -0.395036, -0.000320, 0.000000, 0.115975, -0.410917, 0.990720, -0.579803, -0.115975}, 
{0.000000, 0.000204, -0.714815, 1.067588, -0.352773, -0.000204, 0.000000, 0.101477, -0.392069, 0.990947, -0.598878, -0.101477}, 
{0.000000, 0.000113, -0.697941, 1.014352, -0.316411, -0.000113, 0.000000, 0.083071, -0.367221, 0.988362, -0.621142, -0.083071}, 
{0.000000, 0.000048, -0.683446, 0.971587, -0.288140, -0.000048, 0.000000, 0.059767, -0.334049, 0.980495, -0.646446, -0.059767}, 
{0.000000, 0.000010, -0.673706, 0.944115, -0.270408, -0.000010, 0.000000, 0.030323, -0.289231, 0.963141, -0.673910, -0.030323}, 
{-0.000000, -0.035718, -0.642333, 0.966948, -0.324615, 0.035718, -0.000000, -0.003295, -0.239567, 0.942264, -0.702697, 0.003295}, 
{-0.000000, -0.064041, -0.614613, 0.982323, -0.367709, 0.064041, -0.000000, -0.003277, -0.257371, 0.971348, -0.713978, 0.003277}, 
{-0.000000, -0.086449, -0.589559, 0.989077, -0.399518, 0.086449, -0.000000, -0.003246, -0.285005, 1.015390, -0.730384, 0.003246}, 
{-0.000000, -0.104141, -0.567763, 0.991055, -0.423292, 0.104141, -0.000000, -0.003199, -0.320156, 1.069558, -0.749402, 0.003199}, 
{-0.000000, -0.118070, -0.549224, 0.990521, -0.441297, 0.118070, -0.000000, -0.003136, -0.360770, 1.129500, -0.768730, 0.003136}, 
{-0.000000, -0.128987, -0.533659, 0.988800, -0.455141, 0.128987, -0.000000, -0.003055, -0.405118, 1.191503, -0.786385, 0.003055}, 
{-0.000000, -0.137481, -0.520680, 0.986661, -0.465981, 0.137481, -0.000000, -0.002956, -0.451747, 1.252452, -0.800706, 0.002956}, 
{-0.000000, -0.144010, -0.509871, 0.984535, -0.474664, 0.144010, -0.000000, -0.002836, -0.499390, 1.309705, -0.810315, 0.002836}, 
{-0.000000, -0.148922, -0.500831, 0.982656, -0.481825, 0.148922, -0.000000, -0.002694, -0.546865, 1.360950, -0.814084, 0.002694}, 
{-0.000000, -0.152481, -0.493191, 0.981144, -0.487954, 0.152481, -0.000000, -0.002531, -0.592976, 1.404092, -0.811117, 0.002531}, 
{-0.000000, -0.154875, -0.486612, 0.980055, -0.493443, 0.154875, -0.000000, -0.002348, -0.636427, 1.437160, -0.800733, 0.002348}, 
{-0.000000, -0.156233, -0.480788, 0.979411, -0.498623, 0.156233, -0.000000, -0.002145, -0.675762, 1.458223, -0.782460, 0.002145}, 
{-0.000000, -0.156626, -0.475433, 0.979220, -0.503787, 0.156626, -0.000000, -0.001925, -0.709312, 1.465322, -0.756009, 0.001925}, 
{-0.000000, -0.156075, -0.470271, 0.979484, -0.509213, 0.156075, -0.000000, -0.001695, -0.735573, 1.457192, -0.721619, 0.001695}, 
{-0.000000, -0.154551, -0.465022, 0.980199, -0.515177, 0.154551, -0.000000, -0.001462, -0.754317, 1.435264, -0.680947, 0.001462}, 
{-0.000000, -0.151973, -0.459387, 0.981355, -0.521968, 0.151973, -0.000000, -0.001232, -0.765723, 1.401489, -0.635766, 0.001232}, 
{-0.000000, -0.148204, -0.453027, 0.982925, -0.529898, 0.148204, -0.000000, -0.001013, -0.770149, 1.357798, -0.587649, 0.001013}, 
{-0.000000, -0.143042, -0.445535, 0.984843, -0.539308, 0.143042, -0.000000, -0.000809, -0.768167, 1.306170, -0.538004, 0.000809}, 
{-0.000000, -0.136213, -0.436402, 0.986971, -0.550570, 0.136213, -0.000000, -0.000624, -0.760575, 1.248716, -0.488141, 0.000624}, 
{-0.000000, -0.127350, -0.424966, 0.989047, -0.564081, 0.127350, -0.000000, -0.000461, -0.748410, 1.187767, -0.439357, 0.000461}, 
{-0.000000, -0.115975, -0.410346, 0.990586, -0.580241, 0.115975, -0.000000, -0.000320, -0.732966, 1.126002, -0.393035, 0.000320}, 
{-0.000000, -0.101477, -0.391338, 0.990737, -0.599399, 0.101477, -0.000000, -0.000204, -0.715824, 1.066575, -0.350750, 0.000204}, 
{-0.000000, -0.083071, -0.366277, 0.988031, -0.621754, 0.083071, -0.000000, -0.000113, -0.698878, 1.013244, -0.314366, 0.000113}, 
{-0.000000, -0.059767, -0.332820, 0.979968, -0.647148, 0.059767, -0.000000, -0.000048, -0.684326, 0.970401, -0.286075, 0.000048}, 
{-0.000000, -0.030323, -0.287617, 0.962301, -0.674684, 0.030323, -0.000000, -0.000010, -0.674549, 0.942877, -0.268329, 0.000010}, 
{0.000000, 0.003295, -0.237479, 0.940979, -0.703500, -0.003295, 0.000000, 0.035718, -0.643124, 0.966172, -0.323048, -0.035718}, 
{0.000000, 0.003277, -0.255299, 0.970121, -0.714822, -0.003277, 0.000000, 0.064041, -0.615317, 0.981836, -0.366518, -0.064041}, 
{0.000000, 0.003246, -0.282955, 1.014245, -0.731290, -0.003246, 0.000000, 0.086449, -0.590165, 0.988769, -0.398604, -0.086449}, 
{0.000000, 0.003199, -0.318129, 1.068513, -0.750384, -0.003199, 0.000000, 0.104141, -0.568276, 0.990861, -0.422585, -0.104141}, 
{0.000000, 0.003136, -0.358765, 1.128563, -0.769798, -0.003136, 0.000000, 0.118070, -0.549652, 0.990397, -0.440745, -0.118070}, 
{0.000000, 0.003055, -0.403132, 1.190678, -0.787545, -0.003055, 0.000000, 0.128987, -0.534016, 0.988722, -0.454706, -0.128987}, 
{0.000000, 0.002956, -0.449779, 1.251741, -0.801962, -0.002956, 0.000000, 0.137481, -0.520978, 0.986611, -0.465634, -0.137481}, 
{0.000000, 0.002836, -0.497439, 1.309108, -0.811669, -0.002836, 0.000000, 0.144010, -0.510121, 0.984504, -0.474382, -0.144010}, 
{0.000000, 0.002694, -0.544933, 1.360469, -0.815536, -0.002694, 0.000000, 0.148922, -0.501045, 0.982637, -0.481592, -0.148922}, 
{0.000000, 0.002531, -0.591066, 1.403729, -0.812663, -0.002531, 0.000000, 0.152481, -0.493377, 0.981133, -0.487755, -0.152481}, 
{0.000000, 0.002348, -0.634548, 1.436915, -0.802367, -0.002348, 0.000000, 0.154875, -0.486781, 0.980048, -0.493268, -0.154875}, 
{0.000000, 0.002145, -0.673924, 1.458098, -0.784174, -0.002145, 0.000000, 0.156233, -0.480947, 0.979408, -0.498461, -0.156233}, 
{0.000000, 0.001925, -0.707526, 1.465317, -0.757790, -0.001925, 0.000000, 0.156626, -0.475590, 0.979220, -0.503631, -0.156626}, 
{0.000000, 0.001695, -0.733853, 1.457308, -0.723454, -0.001695, 0.000000, 0.156075, -0.470434, 0.979487, -0.509053, -0.156075}, 
{0.000000, 0.001462, -0.752676, 1.435498, -0.682823, -0.001462, 0.000000, 0.154551, -0.465200, 0.980206, -0.515006, -0.154551}, 
{0.000000, 0.001232, -0.764168, 1.401841, -0.637672, -0.001232, 0.000000, 0.151973, -0.459590, 0.981368, -0.521778, -0.151973}, 
{0.000000, 0.001013, -0.768686, 1.358265, -0.589578, -0.001013, 0.000000, 0.148204, -0.453266, 0.982946, -0.529680, -0.148204}, 
{0.000000, 0.000809, -0.766799, 1.306751, -0.539952, -0.000809, 0.000000, 0.143042, -0.445825, 0.984876, -0.539051, -0.143042}, 
{0.000000, 0.000624, -0.759302, 1.249408, -0.490106, -0.000624, 0.000000, 0.136213, -0.436761, 0.987025, -0.550264, -0.136213}, 
{0.000000, 0.000461, -0.747230, 1.188569, -0.441339, -0.000461, 0.000000, 0.127350, -0.425416, 0.989132, -0.563715, -0.127350}, 
{0.000000, 0.000320, -0.731875, 1.126911, -0.395036, -0.000320, 0.000000, 0.115975, -0.410917, 0.990720, -0.579803, -0.115975}, 
{0.000000, 0.000204, -0.714815, 1.067588, -0.352773, -0.000204, 0.000000, 0.101477, -0.392069, 0.990947, -0.598878, -0.101477}, 
{0.000000, 0.000113, -0.697941, 1.014352, -0.316411, -0.000113, 0.000000, 0.083071, -0.367221, 0.988362, -0.621142, -0.083071}, 
{0.000000, 0.000048, -0.683446, 0.971587, -0.288140, -0.000048, 0.000000, 0.059767, -0.334049, 0.980495, -0.646446, -0.059767}, 
{0.000000, 0.000010, -0.673706, 0.944115, -0.270408, -0.000010, 0.000000, 0.030323, -0.289231, 0.963141, -0.673910, -0.030323}, 
{-0.000000, -0.035718, -0.642333, 0.966948, -0.324615, 0.035718, -0.000000, -0.003295, -0.239567, 0.942264, -0.702697, 0.003295}, 
{-0.000000, -0.064041, -0.614613, 0.982323, -0.367709, 0.064041, -0.000000, -0.003277, -0.257371, 0.971348, -0.713978, 0.003277}, 
{-0.000000, -0.086449, -0.589559, 0.989077, -0.399518, 0.086449, -0.000000, -0.003246, -0.285005, 1.015390, -0.730384, 0.003246}, 
{-0.000000, -0.104141, -0.567763, 0.991055, -0.423292, 0.104141, -0.000000, -0.003199, -0.320156, 1.069558, -0.749402, 0.003199}, 
{-0.000000, -0.118070, -0.549224, 0.990521, -0.441297, 0.118070, -0.000000, -0.003136, -0.360770, 1.129500, -0.768730, 0.003136}, 
{-0.000000, -0.128987, -0.533659, 0.988800, -0.455141, 0.128987, -0.000000, -0.003055, -0.405118, 1.191503, -0.786385, 0.003055}, 
{-0.000000, -0.137481, -0.520680, 0.986661, -0.465981, 0.137481, -0.000000, -0.002956, -0.451747, 1.252452, -0.800706, 0.002956}, 
{-0.000000, -0.144010, -0.509871, 0.984535, -0.474664, 0.144010, -0.000000, -0.002836, -0.499390, 1.309705, -0.810315, 0.002836}, 
{-0.000000, -0.148922, -0.500831, 0.982656, -0.481825, 0.148922, -0.000000, -0.002694, -0.546865, 1.360950, -0.814084, 0.002694}, 
{-0.000000, -0.152481, -0.493191, 0.981144, -0.487954, 0.152481, -0.000000, -0.002531, -0.592976, 1.404092, -0.811117, 0.002531}, 
{-0.000000, -0.154875, -0.486612, 0.980055, -0.493443, 0.154875, -0.000000, -0.002348, -0.636427, 1.437160, -0.800733, 0.002348}, 
{-0.000000, -0.156233, -0.480788, 0.979411, -0.498623, 0.156233, -0.000000, -0.002145, -0.675762, 1.458223, -0.782460, 0.002145}, 
{-0.000000, -0.156626, -0.475433, 0.979220, -0.503787, 0.156626, -0.000000, -0.001925, -0.709312, 1.465322, -0.756009, 0.001925}, 
{-0.000000, -0.156075, -0.470271, 0.979484, -0.509213, 0.156075, -0.000000, -0.001695, -0.735573, 1.457192, -0.721619, 0.001695}, 
{-0.000000, -0.154551, -0.465022, 0.980199, -0.515177, 0.154551, -0.000000, -0.001462, -0.754317, 1.435264, -0.680947, 0.001462}, 
{-0.000000, -0.151973, -0.459387, 0.981355, -0.521968, 0.151973, -0.000000, -0.001232, -0.765723, 1.401489, -0.635766, 0.001232}, 
{-0.000000, -0.148204, -0.453027, 0.982925, -0.529898, 0.148204, -0.000000, -0.001013, -0.770149, 1.357798, -0.587649, 0.001013}, 
{-0.000000, -0.143042, -0.445535, 0.984843, -0.539308, 0.143042, -0.000000, -0.000809, -0.768167, 1.306170, -0.538004, 0.000809}, 
{-0.000000, -0.136213, -0.436402, 0.986971, -0.550570, 0.136213, -0.000000, -0.000624, -0.760575, 1.248716, -0.488141, 0.000624}, 
{-0.000000, -0.127350, -0.424966, 0.989047, -0.564081, 0.127350, -0.000000, -0.000461, -0.748410, 1.187767, -0.439357, 0.000461}, 
{-0.000000, -0.115975, -0.410346, 0.990586, -0.580241, 0.115975, -0.000000, -0.000320, -0.732966, 1.126002, -0.393035, 0.000320}, 
{-0.000000, -0.101477, -0.391338, 0.990737, -0.599399, 0.101477, -0.000000, -0.000204, -0.715824, 1.066575, -0.350750, 0.000204}, 
{-0.000000, -0.083071, -0.366277, 0.988031, -0.621754, 0.083071, -0.000000, -0.000113, -0.698878, 1.013244, -0.314366, 0.000113}, 
{-0.000000, -0.059767, -0.332820, 0.979968, -0.647148, 0.059767, -0.000000, -0.000048, -0.684326, 0.970401, -0.286075, 0.000048}, 
{-0.000000, -0.030323, -0.287617, 0.962301, -0.674684, 0.030323, -0.000000, -0.000010, -0.674549, 0.942877, -0.268329, 0.000010}
};

float a[12];

//float a = 106;
float b = 144.5;
float A = 90;
float B;
float kneeAngle;
float left_hip_2_angle;
float left_knee_angle;
float left_ankle_2_angle;
float right_hip_2_angle;
float right_knee_angle;
float right_ankle_2_angle;
bool increasing = false;
float increment = 0.15;
float squat_angle = 30;
float lowest_angle = 15;
float twerk_angle = 50;
int stepdataindex = 0;

float getRadians(float x) {
  return x * M_PI / 180;
}

float getDegrees(float x) {
  return x * 180 / M_PI;
}

void translateangles(float a[], int a_size) {
  a[0] = (a[0] * (-1) + 97 * M_PI / 180) * 180 / M_PI;
  a[1] = (a[1] * (-1) + M_PI * 90 / 180) * 180 / M_PI;
  a[2] = (a[2] + 93 * M_PI / 180) * 180 / M_PI;
  a[3] = (a[3] + 32 * M_PI / 180) * 180 / M_PI;
  a[4] = (a[4] + 95 * M_PI / 180) * 180 / M_PI;
  a[5] = (a[5] * (-1) + 95 * M_PI / 180) * 180 / M_PI;
  a[6] = (a[6] + 90 * M_PI / 180) * 180 / M_PI;
  a[7] = (a[7] + M_PI * 90 / 180) * 180 / M_PI;
  a[8] = (a[8] * (-1) + 105 * M_PI / 180) * 180 / M_PI;
  a[9] = (a[9] * (-1) + 148 * M_PI / 180) * 180 / M_PI;
  a[10] = (a[10] * (-1) + 90 * M_PI / 180) * 180 / M_PI;
  a[11] = (a[11] + 75 * M_PI / 180) * 180 / M_PI;

  // Convert to degrees
  for (int i = 0; i < sizeof(a); i += 1) {
    a[i] = a[i] * 180 / M_PI;
  }
  
  // Serial.print("Elements: ");
  // for (int i = 0; i < sizeof(a); i++) {
  //   Serial.print(a[i]);
  // }

}


void setup() {

  Serial.begin(115200);
  while (!Serial)
    delay(10); // will pause Zero, Leonardo, etc until serial console opens

  Serial.println("Adafruit LSM6DSOX test!");

  if (!sox.begin_I2C()) {
    // if (!sox.begin_SPI(LSM_CS)) {
    // if (!sox.begin_SPI(LSM_CS, LSM_SCK, LSM_MISO, LSM_MOSI)) {
    // Serial.println("Failed to find LSM6DSOX chip");
    while (1) {
      delay(10);
    }
  }

  Serial.println("LSM6DSOX Found!");

  left_hip_1.attach(2);
  left_hip_2.attach(3);
  left_hip_3.attach(4);
  left_knee.attach(5);
  left_ankle_1.attach(6);
  left_ankle_2.attach(7);
  right_hip_1.attach(8);
  right_hip_2.attach(9);
  right_hip_3.attach(10);
  right_knee.attach(11);
  right_ankle_1.attach(12);
  right_ankle_2.attach(13);


  // // Scan files for test values.
  // FILE* file = fopen("JointAngles.txt", "r");
  // if (file == Null) {
  //   Serial.println("Error opening file.");
  // }

  // float array[ROWS][COLS];

  // for (int i = 0; i < ROWS; i++) {
  //   for (int ii = 0; ii < COLS; ii++) {

  //   }
  // }

  left_hip_1.write(97); //97 + is curve in - is curve out
  left_hip_2.write(93); //93 + is back - is forward
  left_hip_3.write(90); //90 + is in - is out
  left_knee.write(32); //32 + is back - is forward
  left_ankle_1.write(95); //95 + is in - is out
  left_ankle_2.write(95); //95 + is back - is forward

  right_hip_1.write(90); //90 + is curve out - is curve in
  right_hip_2.write(105); //105 + is forward - is back
  right_hip_3.write(90); //90 + is out - is in
  right_knee.write(148); //148 + is forward - is back
  right_ankle_1.write(90); //90 + is in - is out
  right_ankle_2.write(75); //75 + is forward - is back
  delay(5000);
}

void loop() {

  for (int i = 0; i < 12; i++) {
    a[i] = stepdata[stepdataindex][i];
  }
  stepdataindex += 1;

  float a[] = {0.000000, 0.001925, -0.749515, 1.463467, -0.713951, -0.001925, 0.000000, 0.001925, -0.749515, 1.463467, -0.713951, -0.001925};
  translateangles(a, sizeof(a));

  left_hip_1.write(a[0]);
  left_hip_2.write(a[2]);
  left_hip_3.write(a[1]);
  left_knee.write(a[3]);
  left_ankle_1.write(a[5]);
  left_ankle_2.write(a[4]);
  
  right_hip_1.write(a[6]);
  right_hip_2.write(a[8]);
  right_hip_3.write(a[7]);
  right_knee.write(a[9]);
  right_ankle_1.write(a[11]);
  right_ankle_2.write(a[10]);

  delay(200);
}